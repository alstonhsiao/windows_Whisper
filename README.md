# Windows èªéŸ³è½‰æ–‡å­—å·¥å…· (Whisper Voice Typing)

> **æŒ‰ä½ç†±éµ â†’ éŒ„éŸ³ â†’ OpenAI Whisper API è¾¨è­˜ â†’ è‡ªå‹•è²¼ä¸Šæ–‡å­—åˆ°æ¸¸æ¨™ä½ç½®**

å°‡ macOS ä¸Šçš„èªéŸ³è½‰æ–‡å­—åŠŸèƒ½ç§»æ¤åˆ° Windows 10/11ï¼Œå–ä»£å‚³çµ±éµç›¤è¼¸å…¥ã€‚

---

## ç›®éŒ„

- [å°ˆæ¡ˆèƒŒæ™¯](#å°ˆæ¡ˆèƒŒæ™¯)
- [å¯¦ä½œç­–ç•¥](#å¯¦ä½œç­–ç•¥)
- [ç›®éŒ„çµæ§‹](#ç›®éŒ„çµæ§‹)
- [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹)
  - [æ–¹æ¡ˆä¸€ï¼šPython + uvï¼ˆæ¨è–¦é¦–é¸ï¼‰](#æ–¹æ¡ˆä¸€python--uvæ¨è–¦é¦–é¸)
  - [æ–¹æ¡ˆäºŒï¼šAutoHotkey v2 + MCI](#æ–¹æ¡ˆäºŒautohotkey-v2--mci)
  - [æ–¹æ¡ˆä¸‰ï¼šPython æ‰“åŒ… .exe](#æ–¹æ¡ˆä¸‰python-æ‰“åŒ…-exe)
- [è¨­å®šèªªæ˜](#è¨­å®šèªªæ˜)
- [ä¸‰æ–¹æ¡ˆæ¯”è¼ƒ](#ä¸‰æ–¹æ¡ˆæ¯”è¼ƒ)
- [é™„éŒ„ï¼šæŠ€è¡“ç´°ç¯€](#é™„éŒ„æŠ€è¡“ç´°ç¯€)

---

## å°ˆæ¡ˆèƒŒæ™¯

### åŸå§‹éœ€æ±‚ï¼ˆmacOS ç‰ˆï¼‰

åœ¨ macOS ä¸Šé€é Keyboard Maestro å¯¦ç¾çš„èªéŸ³è½‰æ–‡å­—åŠŸèƒ½ï¼š

1. **æŒ‰ä½ F1** â†’ é–‹å§‹éŒ„éŸ³ï¼ˆSoX `rec` æŒ‡ä»¤ï¼‰
2. éŒ„éŸ³å°±ç·’å¾Œç™¼å‡º **beep æç¤ºéŸ³**
3. **æ”¾é–‹ F1** â†’ åœæ­¢éŒ„éŸ³
4. è‡ªå‹•é€å¾€ **OpenAI Whisper API** è¾¨è­˜
5. **Regex ä¿®æ­£**å°ˆæœ‰åè© â†’ **Trim ç©ºç™½** â†’ æ¨¡æ“¬è²¼ä¸Šåˆ°æ¸¸æ¨™ä½ç½®

### ä½¿ç”¨æƒ…å¢ƒ

- æ—¥å¸¸å·¥ä½œå¿«é€Ÿè¼¸å…¥ç¹é«”ä¸­æ–‡
- æœƒè­°è¨˜éŒ„ã€è¨Šæ¯å›è¦†ã€æ–‡ä»¶æ’°å¯«
- éœ€æ­£ç¢ºè¾¨è­˜äººåã€å…¬å¸åã€æŠ€è¡“åè©

### ç‚ºä»€éº¼è¦ç§»æ¤åˆ° Windows

macOS ç‰ˆä¾è³´ Keyboard Maestroï¼ˆmacOS å°ˆå±¬ä»˜è²»è»Ÿé«”ï¼‰ï¼ŒWindows ä¸Šéœ€è¦ç¨ç«‹çš„è§£æ±ºæ–¹æ¡ˆã€‚

---

## å¯¦ä½œç­–ç•¥

æ¡ç”¨ä¸‰éšæ®µç­–ç•¥ï¼Œç”±å¿«åˆ°ç©©é€æ­¥æ¨é€²ï¼š

| éšæ®µ | æ–¹æ¡ˆ | ç›®çš„ | ç‹€æ…‹ |
|------|------|------|------|
| **Phase 1** | æ–¹æ¡ˆä¸€ï¼šPython + `uv` å–®æª”è…³æœ¬ | æœ€å¿«é©—è­‰æ•´å€‹æµç¨‹ | ğŸŸ¢ å°±ç·’ |
| **Phase 2** | æ–¹æ¡ˆä¸‰ï¼šPython + PyInstaller æ‰“åŒ… `.exe` | çµ¦åŒäº‹é›¶é–€æª»ä½¿ç”¨ | ğŸŸ¢ å°±ç·’ |
| **Phase 3** | æ–¹æ¡ˆäºŒï¼šAutoHotkey v2 + Windows MCI | æœ€è¼•é‡ fallback | ğŸŸ¢ å°±ç·’ |

### é—œéµæŠ€è¡“æ±ºç­–

| æ±ºç­– | é¸æ“‡ | åŸå›  |
|------|------|------|
| éŒ„éŸ³ | `sounddevice`ï¼ˆPythonï¼‰/ MCIï¼ˆAHKï¼‰ | è¨˜æ†¶é«”å…§æ“ä½œï¼Œé¿å… SoX çš„ WAV header æå£å•é¡Œ |
| ç†±éµ | `pynput` | ä¸éœ€ç®¡ç†å“¡æ¬Šé™ï¼ˆ`keyboard` å¥—ä»¶éœ€è¦ï¼‰ |
| API å‘¼å« | `requests` / `curl.exe` | åªå‘¼å«ä¸€å€‹ endpointï¼Œæ¯” `openai` SDK å°‘ 15 å€‹å­ä¾è³´ |
| æç¤ºéŸ³ | `winsound.Beep` / `SoundBeep` | Windows å…§å»ºï¼Œé›¶ä¾è³´ |
| ç’°å¢ƒç®¡ç† | `uv` + PEP 723 | å–®æª”å³å®Œæ•´ç¨‹å¼ï¼Œä¸€è¡Œå•Ÿå‹• |

---

## ç›®éŒ„çµæ§‹

```
windows_Whisper/
â”œâ”€â”€ .env.local                      â† API Keyï¼ˆä¸æœƒæ¨é€åˆ° GitHubï¼‰
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md                       â† æœ¬æ–‡ä»¶
â”‚
â”œâ”€â”€ approach-1-python-uv/           â† æ–¹æ¡ˆä¸€ï¼šPython + uv å–®æª”è…³æœ¬
â”‚   â””â”€â”€ main.py                     â† å–®æª”ï¼ˆå« PEP 723 ä¾è³´å®£å‘Šï¼‰
â”‚
â”œâ”€â”€ approach-2-ahk-mci/             â† æ–¹æ¡ˆäºŒï¼šAutoHotkey v2 + MCI
â”‚   â”œâ”€â”€ whisper.ahk                 â† AHK v2 ä¸»ç¨‹å¼
â”‚   â””â”€â”€ config.ini                  â† è¨­å®šæª”
â”‚
â””â”€â”€ approach-3-python-exe/          â† æ–¹æ¡ˆä¸‰ï¼šPython æ‰“åŒ… .exe
    â”œâ”€â”€ main.py                     â† ä¸»ç¨‹å¼
    â”œâ”€â”€ config.json                 â† è¨­å®šæª”
    â”œâ”€â”€ requirements.txt            â† pip ä¾è³´
    â””â”€â”€ build.bat                   â† PyInstaller æ‰“åŒ…è…³æœ¬
```

---

## å¿«é€Ÿé–‹å§‹

### å‰ç½®éœ€æ±‚

1. **OpenAI API Key** â€” å‰å¾€ [platform.openai.com/api-keys](https://platform.openai.com/api-keys) å–å¾—
2. **éº¥å…‹é¢¨** â€” å…§å»ºæˆ–å¤–æ¥çš†å¯
3. **ç¶²è·¯é€£ç·š** â€” Whisper API éœ€è¦é€£ç¶²
4. **Windows 10 1803+**ï¼ˆæ–¹æ¡ˆäºŒä¸‰éœ€è¦å…§å»ºçš„ `curl.exe`ï¼‰

### è¨­å®š API Key

ç·¨è¼¯å°ˆæ¡ˆæ ¹ç›®éŒ„çš„ `.env.local`ï¼š
```
OPENAI_API_KEY=sk-your-actual-key-here
```

---

### æ–¹æ¡ˆä¸€ï¼šPython + uvï¼ˆæ¨è–¦é¦–é¸ï¼‰

> æœ€å¿«ä¸Šæ‰‹ã€æœ€ç©©å®šã€å–®æª”å³å®Œæ•´ç¨‹å¼

**å®‰è£ uvï¼ˆä¸€æ¬¡æ€§ï¼‰ï¼š**
```powershell
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
```

**å•Ÿå‹•ï¼š**
```bash
cd approach-1-python-uv
uv run main.py
```

`uv` æœƒè‡ªå‹•å»ºè™›æ“¬ç’°å¢ƒã€å®‰è£ä¾è³´ã€åŸ·è¡Œè…³æœ¬ï¼ˆé¦–æ¬¡ ~5 ç§’ï¼Œå¾ŒçºŒ <1 ç§’ï¼‰ã€‚

**æ“ä½œï¼š**
- æŒ‰ä½ **F1** â†’ è½åˆ° beep å¾Œé–‹å§‹èªªè©±
- æ”¾é–‹ **F1** â†’ è‡ªå‹•è¾¨è­˜ä¸¦è²¼ä¸Šæ–‡å­—
- **Ctrl+Shift+Q** â†’ çµæŸç¨‹å¼

---

### æ–¹æ¡ˆäºŒï¼šAutoHotkey v2 + MCI

> æœ€è¼•é‡ã€ä¸éœ€ Pythonã€é©åˆä½œç‚º fallback

**å®‰è£ AutoHotkey v2ï¼š**
å‰å¾€ [autohotkey.com](https://www.autohotkey.com/) ä¸‹è¼‰å®‰è£ï¼ˆ~5MBï¼‰

**è¨­å®šï¼š**
ç·¨è¼¯ `approach-2-ahk-mci/config.ini`ï¼Œå¡«å…¥ API Key

**å•Ÿå‹•ï¼š**
é›™æ“Š `approach-2-ahk-mci/whisper.ahk`

**æ“ä½œåŒä¸Š**ï¼ˆF1 æŒ‰ä½/æ”¾é–‹ï¼‰ã€‚å³éµç³»çµ±åŒ£åœ–ç¤ºå¯çµæŸç¨‹å¼ã€‚

---

### æ–¹æ¡ˆä¸‰ï¼šPython æ‰“åŒ… .exe

> çµ¦åŒäº‹ã€Œé›™æ“Šå³ç”¨ã€ï¼Œä¸éœ€å®‰è£ä»»ä½•æ±è¥¿

**é–‹ç™¼è€…ï¼ˆæ‰“åŒ…ï¼‰ï¼š**
```bash
cd approach-3-python-exe
pip install -r requirements.txt

# æ¸¬è©¦
python main.py

# æ‰“åŒ…
build.bat
```

**çµ‚ç«¯ä½¿ç”¨è€…ï¼ˆåŒäº‹ï¼‰ï¼š**
1. å–å¾— `WhisperVoiceTyping.exe` + `config.json`
2. ç·¨è¼¯ `config.json` å¡«å…¥ API Key
3. é›™æ“Š exe å•Ÿå‹•

---

## è¨­å®šèªªæ˜

### API Key å„ªå…ˆé †åº

1. ç’°å¢ƒè®Šæ•¸ `OPENAI_API_KEY`ï¼ˆæœ€å„ªå…ˆï¼‰
2. `.env.local` æª”æ¡ˆ
3. `config.json` / `config.ini` ä¸­çš„è¨­å®š

### Whisper API åƒæ•¸

| åƒæ•¸ | å€¼ | èªªæ˜ |
|------|-----|------|
| `model` | `whisper-1` | OpenAI Whisper æ¨¡å‹ |
| `language` | `zh` | ISO-639-1 èªè¨€ç¢¼ï¼Œå¼·åˆ¶ä¸­æ–‡è¾¨è­˜ |
| `temperature` | `0.0` | 0 = æœ€ç²¾ç¢ºï¼ˆä¸å¼•å…¥éš¨æ©Ÿæ€§ï¼‰ |
| `prompt` | è¦‹ä¸‹æ–¹ | è©å½™å¼•å°ï¼Œæœ€å¤š 224 tokens |

### Promptï¼ˆè©å½™å¼•å°ï¼‰

é è¨­ï¼š
```
è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚åŒ…å«ï¼šè•­æ·³äº‘, å‘¨èŠ·è“, åˆä½œå» å•†åŠ æ¨¡, å°ˆæ¡ˆ Tahoe, n8n, Zeaburã€‚
```

- `è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡` â€” å¼·åˆ¶è¼¸å‡ºç¹é«”
- `åŒ…å«ï¼š...` â€” å°ˆæœ‰åè©åƒè€ƒï¼Œæå‡è¾¨è­˜æº–ç¢ºåº¦
- å¯åœ¨è¨­å®šæª”ä¸­è‡ªè¨‚

### Regex å¾Œè™•ç†è¦å‰‡

| æœå°‹æ¨¡å¼ | æ›¿æ›ç‚º | èªªæ˜ |
|---------|--------|------|
| `N8n\|N 8 n` | `n8n` | Whisper å¸¸èª¤è¾¨è­˜çš„åè©ä¿®æ­£ |

è¦å‰‡å¯åœ¨è¨­å®šæª”ä¸­æ“´å……ã€‚

### éŒ„éŸ³è¦æ ¼

| åƒæ•¸ | å€¼ | èªªæ˜ |
|------|-----|------|
| å–æ¨£ç‡ | 16000 Hz | Whisper æœ€ä½³è¦æ ¼ |
| è²é“ | 1ï¼ˆMonoï¼‰ | èªéŸ³è¾¨è­˜ä¸éœ€ç«‹é«”è² |
| ä½å…ƒæ·±åº¦ | 16-bit PCM | æ¨™æº–å“è³ª |
| æ ¼å¼ | WAV | ç„¡æï¼Œ~32KB/ç§’ |

### ç†±éµ

é è¨­ **F1**ï¼Œå¯åœ¨è¨­å®šæª”ä¸­æ”¹ç‚º F2-F12ã€‚

> **æ³¨æ„ï¼š** F1 åœ¨å¾ˆå¤šæ‡‰ç”¨ç¨‹å¼æ˜¯ã€Œèªªæ˜ã€éµï¼Œå¦‚æœ‰è¡çªå¯æ”¹ç”¨ F8 ç­‰ã€‚

---

## ä¸‰æ–¹æ¡ˆæ¯”è¼ƒ

| | æ–¹æ¡ˆä¸€ï¼šPython+uv | æ–¹æ¡ˆäºŒï¼šAHK+MCI | æ–¹æ¡ˆä¸‰ï¼šPython .exe |
|---|---|---|---|
| **å®‰è£é–€æª»** | éœ€è£ uv | éœ€è£ AHK v2 | é›™æ“Š exe å³ç”¨ |
| **æª”æ¡ˆå¤§å°** | ~1KBï¼ˆå–®æª” .pyï¼‰ | ~10KBï¼ˆ.ahk + .iniï¼‰ | ~30-50MBï¼ˆ.exeï¼‰ |
| **éŒ„éŸ³ç©©å®šåº¦** | â­â­â­â­â­ sounddevice è¨˜æ†¶é«”æ“ä½œ | â­â­â­â­ MCI save å®Œæ•´å¯«å…¥ | â­â­â­â­â­ åŒæ–¹æ¡ˆä¸€ |
| **ç®¡ç†å“¡æ¬Šé™** | ä¸éœ€è¦ï¼ˆpynputï¼‰ | è¦–ç›®æ¨™è¦–çª—è€Œå®š | ä¸éœ€è¦ï¼ˆpynputï¼‰ |
| **å¸¸é§ RAM** | ~30MB | ~3-5MB | ~30MB |
| **å¯ç¶­è­·æ€§** | Pythonï¼ˆé–‹ç™¼è€…å¤šï¼‰ | AHKï¼ˆè¼ƒå°çœ¾ï¼‰ | Python |
| **é–‹ç™¼æ™‚é–“** | 2-3 å°æ™‚ | 3-5 å°æ™‚ | 3-4 å°æ™‚ |
| **é©åˆå ´æ™¯** | è‡ªå·±ç”¨ã€å¿«é€Ÿé©—è­‰ | è¼•é‡ fallback | åˆ†ç™¼çµ¦åŒäº‹ |

---

## é™„éŒ„ï¼šæŠ€è¡“ç´°ç¯€

### A. éŒ„éŸ³æ©Ÿåˆ¶æ¯”è¼ƒ

**ç‚ºä»€éº¼ä¸ç”¨ SoXï¼š**
- Windows ä¸Š SoX åœæ­¢éŒ„éŸ³éœ€ `taskkill`ï¼ˆå¼·åˆ¶çµ‚æ­¢ï¼‰ï¼Œå¯èƒ½å°è‡´ WAV header æå£
- macOS ä¸Š SoX `rec` æ”¶åˆ° SIGINT æœƒæ­£ç¢ºæ”¶å°¾ï¼Œä½† Windows æ²’æœ‰ç­‰æ•ˆæ©Ÿåˆ¶

**sounddeviceï¼ˆæ–¹æ¡ˆä¸€ä¸‰ï¼‰ï¼š**
- PortAudio callback åœ¨èƒŒæ™¯ç·šç¨‹æ”¶é›†éŸ³è¨Šåˆ°è¨˜æ†¶é«” buffer
- `stop()` æ™‚æ‰ç”¨ `soundfile.write()` å¯«å…¥å®Œæ•´ WAV
- å¾æ ¹æœ¬ä¸Šé¿å… WAV æå£å•é¡Œ

**MCIï¼ˆæ–¹æ¡ˆäºŒï¼‰ï¼š**
- Windows å…§å»º `winmm.dll` çš„ Media Control Interface
- `save` æŒ‡ä»¤æœƒå¯«å…¥å®Œæ•´ WAV header
- ä¸éœ€å¤–éƒ¨ç¨‹å¼

### B. ç†±éµåµæ¸¬

**pynput vs keyboardï¼ˆPython å¥—ä»¶ï¼‰ï¼š**
- `keyboard` éœ€è¦ç®¡ç†å“¡æ¬Šé™ â†’ æ¯æ¬¡åŸ·è¡Œè¦å³éµã€Œä»¥ç®¡ç†å“¡èº«ä»½åŸ·è¡Œã€
- `pynput` ä¸éœ€ç®¡ç†å“¡ â†’ ç›´æ¥é›™æ“ŠåŸ·è¡Œ
- å…©è€…åŠŸèƒ½ç›¸è¿‘ï¼Œé¸ `pynput`

**AHK v2 ç†±éµç³»çµ±ï¼š**
- KeyDown / KeyUp åµæ¸¬æ˜¯ AHK çš„æ ¸å¿ƒåŠŸèƒ½
- `#MaxThreadsPerHotkey 1` é˜²æ­¢é‡è¤‡è§¸ç™¼
- æœ€åŸç”Ÿå¯é çš„ç†±éµæ–¹æ¡ˆ

### C. Beep æç¤ºéŸ³æ©Ÿåˆ¶

éŒ„éŸ³å•Ÿå‹•æœ‰å»¶é²ï¼ˆ0.1-0.5 ç§’ï¼‰ï¼Œéœ€ç­‰å¾…å°±ç·’å¾Œæ‰é€šçŸ¥ä½¿ç”¨è€…ï¼š

```
éŒ„éŸ³é–‹å§‹ â†’ ç­‰å¾… buffer > 4000 samplesï¼ˆ~0.25 ç§’ï¼‰
â†’ æ’­æ”¾ beepï¼ˆ1000Hz, 200msï¼‰
â†’ ä½¿ç”¨è€…è½åˆ° beep å¾Œé–‹å§‹èªªè©±
```

é¿å…ä½¿ç”¨è€…åœ¨éŒ„éŸ³å°šæœªå°±ç·’æ™‚é–‹å£ï¼Œå°è‡´å‰å¹¾å€‹å­—è¢«æˆªæ–·ã€‚

### D. Whisper API å‘¼å«

```
POST https://api.openai.com/v1/audio/transcriptions
Content-Type: multipart/form-data

file: @voice.wav
model: whisper-1
language: zh
temperature: 0.0
prompt: è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚...
```

è²»ç”¨ï¼š$0.006 USD / åˆ†é˜ï¼ˆæ¥µä½æˆæœ¬ï¼‰

### E. è²¼ä¸Šæ–‡å­—æµç¨‹

1. å°‡è¾¨è­˜çµæœå¯«å…¥ç³»çµ±å‰ªè²¼ç°¿
2. æ¨¡æ“¬ `Ctrl+V` è²¼ä¸Šåˆ°ç•¶å‰ç„¦é»è¦–çª—çš„æ¸¸æ¨™ä½ç½®
3. ç­‰æ•ˆæ–¼ macOS Keyboard Maestro çš„ `InsertText ByPasting`

### F. éŒ¯èª¤è™•ç†

| ç‹€æ³ | è™•ç†æ–¹å¼ |
|------|---------|
| API Key æœªè¨­å®š | å•Ÿå‹•æ™‚æç¤ºè¨­å®š |
| éŒ„éŸ³ < 0.5 ç§’ | å¿½ç•¥ä¸¦æç¤ºã€ŒéŒ„éŸ³æ™‚é–“éçŸ­ã€ |
| API 401 | æç¤ºã€ŒAPI Key ç„¡æ•ˆã€ |
| API 429 | æç¤ºã€Œè«‹æ±‚éæ–¼é »ç¹ã€ |
| ç¶²è·¯é€¾æ™‚ (>30s) | æç¤ºã€Œç¶²è·¯é€¾æ™‚ã€ |
| WAV > 25MB | Whisper API é™åˆ¶ï¼Œç´„ 13 åˆ†é˜éŒ„éŸ³ä¸Šé™ |

### G. æ‰‹å‹•æ¸¬è©¦ APIï¼ˆé©—è­‰ Key å¯ç”¨ï¼‰

```batch
curl.exe -s -f ^
  -H "Authorization: Bearer sk-your-key-here" ^
  -H "Content-Type: multipart/form-data" ^
  -F file="@test.wav" ^
  -F model="whisper-1" ^
  -F language="zh" ^
  -F temperature="0.0" ^
  -F prompt="è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚" ^
  "https://api.openai.com/v1/audio/transcriptions"
```

### H. æœªä¾†å¯æ“´å……åŠŸèƒ½

- **å¤šèªè¨€åˆ‡æ›** â€” å¿«æ·éµåˆ‡æ› zh/en/ja
- **æ­·å²è¨˜éŒ„** â€” SQLite å„²å­˜éå»çš„è¾¨è­˜çµæœ
- **è‡ªè¨‚ä¿®æ­£è©åº«** â€” GUI ç·¨è¼¯ Regex è¦å‰‡
- **èªéŸ³æŒ‡ä»¤** â€” ã€Œæ›è¡Œã€â†’ `\n`ï¼Œã€Œå¥è™Ÿã€â†’ `ã€‚`
- **é›¢ç·šæ¨¡å¼** â€” ä½¿ç”¨æœ¬åœ° whisper.cppï¼ˆéœ€ä¸‹è¼‰ ~3GB æ¨¡å‹ï¼‰

---

## ç³»çµ±éœ€æ±‚

- Windows 10 1803+ï¼ˆå…§å»º curl.exeï¼‰
- éº¥å…‹é¢¨ï¼ˆéœ€åœ¨ è¨­å®š â†’ éš±ç§ â†’ éº¥å…‹é¢¨ ä¸­å…è¨±å­˜å–ï¼‰
- ç¶²è·¯é€£ç·š
- OpenAI å¸³è™Ÿ + API Key

---

## æˆæ¬Š

æœ¬å°ˆæ¡ˆä¾›å­¸ç¿’èˆ‡å€‹äººä½¿ç”¨ã€‚OpenAI Whisper API ä½¿ç”¨éœ€éµå®ˆ [OpenAI æœå‹™æ¢æ¬¾](https://openai.com/terms)ã€‚
